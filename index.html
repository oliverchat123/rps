<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Oliver RPS</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 400px;
    margin: auto;
    padding: 20px;
    min-height: 100vh;
    background: linear-gradient(90deg, #2a7b9b, #57c785, #53bfeD);
    background-size: cover;
    color: white;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 2px 2px 5px #0008;
  }
  #setup, #game, #resultScreen {
    background: rgba(255 255 255 / 0.15);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    margin-top: 20px;
  }
  button {
    cursor: pointer;
    pointer-events: auto;
  }

  input, button {
    width: 100%;
    font-size: 18px;
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 10px;
    border: none;
  }
  input {
    background: #fff;
    color: #333;
    border: 2px solid #ccc;
  }
  input:focus {
    border-color: #0074e4;
    outline: none;
  }
  .rps-button {
    margin-right: 10px; /* space between buttons */
  }

  /* Optional: Remove margin from the last button */
  .rps-button:last-child {
    margin-right: 0;
  }
  .buttons-container {
    display: flex;
    gap: 10px; /* adds spacing between flex items */
  }

  button {
    background: linear-gradient(to right, #5522fa, #0074e4);
    color: white;
    cursor: pointer;
    transition: transform 0.2s ease;
    size: auto;
  }
  .buttons-container {
    display: flex;
    gap: 15px;
  }
  .rps-button {
    margin-right: 15px;
  }
  .choisebtn {
      width: 80%;
  }
  /* Remove margin on last button */
  .rps-button:last-child {
    margin-right: 0;
  }

  button:hover:not(:disabled) {
    transform: scale(1.05);
  }
  button:disabled {
    opacity: 0.6;
    cursor: default;
  }
  #scoreboard {
    display: flex;
    justify-content: space-around;
    margin-bottom: 15px;
  }
  .scoreBox {
    background: rgba(255 255 255 / 0.25);
    border-radius: 12px;
    padding: 15px 25px;
    text-align: center;
    font-weight: bold;
    font-size: 1.2em;
  }
  #status {
    font-weight: bold;
    margin-bottom: 15px;
    text-align: center;
  }
  #choices {
    display: flex;
    justify-content: space-around;
  }
  
  .choiceBtn {
    font-size: 40px;
    padding: 15px 20px;
    border-radius: 12px;
    background: rgba(255 255 255 / 0.2);
    border: none;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  .choiceBtn:hover:not(:disabled) {
    background: rgba(255 255 255 / 0.4);
  }
  input, textarea {
    max-width: 100%;
    box-sizing: border-box;
  }
  .rps-buttons {
    display: flex;
    justify-content: center; /* centers buttons horizontally */
    gap: 15px; /* space between buttons */
    margin: 20px 0; /* optional vertical spacing */
  }

  .rps-buttons button {
    cursor: pointer;
    padding: 10px 20px;
    font-size: 40px;
  }

  #resultText {
    font-size: 2em;
    text-align: center;
    margin-bottom: 15px;
    margin-left: 15px;
    margin-right: 15px;
  }
  #resultScreen p {
    font-size: 1.1em;
    margin: 5px 0;
    text-align: center;
  }

  /* Animations */
  #resultText.animate-win {
    animation: pulseWin 0.8s;
    color: #4caf50;
  }
  #resultText.animate-lose {
    animation: pulseLose 0.8s;
    color: #f44336;
  }
  #resultText.animate-tie {
    animation: shakeTie 0.6s;
    color: #ffc107;
  }

  @keyframes pulseWin {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }
  @keyframes pulseLose {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }
  @keyframes shakeTie {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
  }
</style>
</head>
<body>

<h1>Oliver RPS</h1>

<!-- SETUP SCREEN -->
<div id="setup">
    <input id="playerNameInput" placeholder="Your Name" />
    <button id="createBtn">Create Game</button>
    <div id="roomCodeDisplay" style="font-weight:bold; text-align:center; margin-bottom: 15px;"></div>
    <input id="joinCodeInput" placeholder="Room Code (6 chars)" />
    <button id="joinBtn">Join Game</button>
</div>

<!-- GAME SCREEN -->
<!-- GAME SCREEN -->
<div id="game" style="display:none;">
<!-- Room Code Display in Game -->
<div id="roomCodeInGame" style="font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px;">
    Room Code: 
  </div>
  
  <!-- Your existing score display should come after this -->
  <div id="scoreboard">
    <div>
      <span id="player1Name">Player 1</span>: <span id="player1Score">0</span>
    </div>
    <div>
      <span id="player2Name">Player 2</span>: <span id="player2Score">0</span>
    </div>
  </div>
      <div id="status">Waiting for players...</div>
    <div class="rps-buttons">
      <button class="choiceBtn" data-choice="rock">ü™®</button>
      <button class="choiceBtn" data-choice="paper">üìÑ</button>
      <button class="choiceBtn" data-choice="scissors">‚úÇÔ∏è</button>
    </div>
  </div>
  
<!-- RESULT SCREEN -->
<div id="resultScreen" style="display:none;">
  <div id="resultText"></div>
  <p>Player 1 (<span id="resPlayer1Name"></span>): <span id="resPlayer1Score"></span></p>
  <p>Player 2 (<span id="resPlayer2Name"></span>): <span id="resPlayer2Score"></span></p>
  <button id="continueBtn">Continue</button>
  <button id="leaveBtn">Leave Room</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAZ6kLwtn3ulk5DMaxxjMZOKp2Lscg2njo",
  authDomain: "rock-paper-scissors-72ad9.firebaseapp.com",
  databaseURL: "https://rock-paper-scissors-72ad9-default-rtdb.firebaseio.com",
  projectId: "rock-paper-scissors-72ad9",
  storageBucket: "rock-paper-scissors-72ad9.appspot.com",
  messagingSenderId: "492191154696",
  appId: "1:492191154696:web:9ff5d928599dd21311c7bd",
  measurementId: "G-LF97H69SB0"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Elements
const setupDiv = document.getElementById('setup');
const gameDiv = document.getElementById('game');
const resultDiv = document.getElementById('resultScreen');

const createBtn = document.getElementById('createBtn');
const joinBtn = document.getElementById('joinBtn');
const playerNameInput = document.getElementById('playerNameInput');
const joinCodeInput = document.getElementById('joinCodeInput');
const roomCodeDisplay = document.getElementById('roomCodeDisplay');

const player1NameDisplay = document.getElementById('player1Name');
const player2NameDisplay = document.getElementById('player2Name');
const player1ScoreDisplay = document.getElementById('player1Score');
const player2ScoreDisplay = document.getElementById('player2Score');

const statusDisplay = document.getElementById('status');
const choiceButtons = document.querySelectorAll('.choiceBtn');

const resultText = document.getElementById('resultText');
const resPlayer1Name = document.getElementById('resPlayer1Name');
const resPlayer2Name = document.getElementById('resPlayer2Name');
const resPlayer1Score = document.getElementById('resPlayer1Score');
const resPlayer2Score = document.getElementById('resPlayer2Score');
const continueBtn = document.getElementById('continueBtn');
const leaveBtn = document.getElementById('leaveBtn');

let roomId = "";
let playerId = ""; // 'player1' or 'player2'
let playerName = "";
let opponentName = "";

let gameRef = null;
let unsubscribe = null;

// Sound Effects
const winSound = new Audio("win.mp3");
const loseSound = new Audio("lose.mp3");
const tieSound = new Audio("tie.mp3");
const clickSound = new Audio("btn.mp3");

document.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("click", () => clickSound.play());
});

// Create game room
createBtn.onclick = async () => {
  playerName = playerNameInput.value.trim();
  if (!playerName) return alert("Please enter your name.");
  
  // Generate 6-char room code uppercase
  roomId = Math.random().toString(36).substring(2,8).toUpperCase();
  playerId = "player1";
  gameRef = ref(db, "games/" + roomId);
  
  // Set initial game data
  await set(gameRef, {
    player1: { name: playerName, choice: null, score: 0 },
    player2: { name: null, choice: null, score: 0 },
    resultShown: false
  });
  
  document.getElementById('roomCodeInGame').textContent = "Room Code: " + roomId;

  // SHOW THE ROOM CODE TO THE PLAYER
  roomCodeDisplay.textContent = `Room Code: ${roomId}`;
  
  // Update UI
  setupDiv.style.display = "none";
  gameDiv.style.display = "block";
  resultDiv.style.display = "none";
  
  player1NameDisplay.textContent = playerName;
  player2NameDisplay.textContent = "Waiting...";
  player1ScoreDisplay.textContent = 0;
  player2ScoreDisplay.textContent = 0;
  
  statusDisplay.textContent = "Waiting for opponent to join...";
  enableChoices(false); // disable choices until opponent joins
  
  listenForGameUpdates();
};

// Join game room
joinBtn.onclick = async () => {
  playerName = playerNameInput.value.trim();
  if (!playerName) return alert("Please enter your name.");
  
  const code = joinCodeInput.value.trim().toUpperCase();
  if (code.length !== 6) return alert("Room code must be 6 characters.");
  
  roomId = code;
  gameRef = ref(db, "games/" + roomId);
  
  // Read game data once
  const snapshot = await new Promise(resolve => onValue(gameRef, resolve, {onlyOnce:true}));
  const data = snapshot.val();
  
  if (!data) {
    alert("Room does not exist.");
    return;
  }
  
  if (data.player2.name) {
    alert("Room is full.");
    return;
  }
  
  playerId = "player2";
  
  // Update player2 info
  await update(gameRef, {
    "player2/name": playerName,
    "player2/choice": null,
    resultShown: false
  });
  
  // Update UI
  setupDiv.style.display = "none";
  gameDiv.style.display = "block";
  resultDiv.style.display = "none";
  
  player2NameDisplay.textContent = playerName;
  player1NameDisplay.textContent = data.player1.name;
  player1ScoreDisplay.textContent = data.player1.score || 0;
  player2ScoreDisplay.textContent = data.player2.score || 0;
  
  statusDisplay.textContent = "Opponent connected. Make your choice!";
  enableChoices(true);
  
  listenForGameUpdates();
};

function enableChoices(enable) {
  choiceButtons.forEach(btn => {
    btn.disabled = !enable;
  });
}

choiceButtons.forEach(btn => {
  btn.onclick = async () => {
    if (!gameRef || !playerId) return;
    const choice = btn.getAttribute("data-choice");
    
    // Save choice to database
    await update(gameRef, {
      [`${playerId}/choice`]: choice
    });
    
    statusDisplay.textContent = "Choice made. Waiting for opponent...";
    enableChoices(false);
  };
});

continueBtn.onclick = async () => {
  // Reset choices & resultShown flag for next round
  if (!gameRef) return;
  await update(gameRef, {
    "player1/choice": null,
    "player2/choice": null,
    resultShown: false
  });
  
  resultDiv.style.display = "none";
  gameDiv.style.display = "block";
  statusDisplay.textContent = "Make your choice!";
  enableChoices(true);
};

leaveBtn.onclick = () => {
  location.reload();
};

// Listen to game updates from Firebase
function listenForGameUpdates() {
  if (unsubscribe) unsubscribe();
  unsubscribe = onValue(gameRef, snapshot => {
    const data = snapshot.val();
    if (!data) return;

    // Update player names & scores
    player1NameDisplay.textContent = data.player1.name || "Player 1";
    player2NameDisplay.textContent = data.player2.name || "Player 2";
    player1ScoreDisplay.textContent = data.player1.score || 0;
    player2ScoreDisplay.textContent = data.player2.score || 0;

    // If one player missing
    if (!data.player1.name || !data.player2.name) {
      statusDisplay.textContent = "Waiting for opponent to join...";
      enableChoices(false);
      return;
    }

    // Show waiting or allow choice
    if (!data.player1.choice || !data.player2.choice) {
      // If current player hasn't chosen yet
      if (data[playerId].choice === null) {
        statusDisplay.textContent = "Make your choice!";
        enableChoices(true);
      } else {
        statusDisplay.textContent = "Waiting for opponent...";
        enableChoices(false);
      }
      return;
    }

    // Both choices made and result not shown => show result
    if (!data.resultShown) {
      showResult(data);
    }
  });
}

// Determine winner & show result
function showResult(data) {
  const p1Choice = data.player1.choice;
  const p2Choice = data.player2.choice;
  const p1Name = data.player1.name;
  const p2Name = data.player2.name;
  let winner = null; // 'player1', 'player2', or 'tie'

  if (p1Choice === p2Choice) winner = "tie";
  else if (
    (p1Choice === "rock" && p2Choice === "scissors") ||
    (p1Choice === "scissors" && p2Choice === "paper") ||
    (p1Choice === "paper" && p2Choice === "rock")
  ) winner = "player1";
  else winner = "player2";

  // Update scores locally first (do not directly write here, wait to update DB after)
  let p1Score = data.player1.score || 0;
  let p2Score = data.player2.score || 0;

  if (winner === "player1") p1Score++;
  else if (winner === "player2") p2Score++;

  // Update resultShown and scores in DB
  update(gameRef, {
    "player1/score": p1Score,
    "player2/score": p2Score,
    resultShown: true
  });

  // Show results screen UI
  gameDiv.style.display = "none";
  resultDiv.style.display = "block";

  // Result text & animation
  if (winner === "tie") {
    resultText.textContent = "Tie!";
    resultText.className = "animate-tie";
    tieSound.play();
  } else if (winner === playerId) {
    resultText.textContent = "You Win!";
    resultText.className = "animate-win";
    winSound.play();
  } else {
    resultText.textContent = "You Lose!";
    resultText.className = "animate-lose";
    loseSound.play();
  }

  resPlayer1Name.textContent = p1Name;
  resPlayer2Name.textContent = p2Name;
  resPlayer1Score.textContent = p1Score;
  resPlayer2Score.textContent = p2Score;
}

</script>

</body>
</html>
