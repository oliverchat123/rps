<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Multiplayer Rock Paper Scissors</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #f5f5f5;
    padding: 20px;
  }
  button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 16px;
  }
  #choices {
    margin-top: 20px;
  }
  .choice {
    font-size: 24px;
    cursor: pointer;
  }
  #result {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Multiplayer Rock Paper Scissors</h1>

<div id="setup">
  <button id="createGame">Create Game</button>
  <input type="text" id="joinCode" placeholder="Enter Room Code" />
  <button id="joinGame">Join Game</button>
</div>

<div id="game" style="display:none;">
  <h2 id="roomDisplay">Room: </h2>
  <h3 id="status">Waiting for another player...</h3>
  <div id="choices">
    <button class="choice" data-choice="rock">ü™® Rock</button>
    <button class="choice" data-choice="paper">üìÑ Paper</button>
    <button class="choice" data-choice="scissors">‚úÇÔ∏è Scissors</button>
  </div>
  <div id="result"></div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // TODO: REPLACE these with your Firebase project config
  const firebaseConfig = {
    apiKey: "AIzaSyAZ6kLwtn3ulk5DMaxxjMZOKp2Lscg2njo",
    authDomain: "rock-paper-scissors-72ad9.firebaseapp.com",
    databaseURL: "https://rock-paper-scissors-72ad9-default-rtdb.firebaseio.com",
    projectId: "rock-paper-scissors-72ad9",
    storageBucket: "rock-paper-scissors-72ad9.firebasestorage.app",
    messagingSenderId: "492191154696",
    appId: "1:492191154696:web:9ff5d928599dd21311c7bd",
    measurementId: "G-LF97H69SB0"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // DOM elements
  const createBtn = document.getElementById('createGame');
  const joinBtn = document.getElementById('joinGame');
  const joinCodeInput = document.getElementById('joinCode');
  const setupDiv = document.getElementById('setup');
  const gameDiv = document.getElementById('game');
  const choices = document.querySelectorAll('.choice');
  const status = document.getElementById('status');
  const resultDiv = document.getElementById('result');
  const roomDisplay = document.getElementById('roomDisplay');

  let roomId = "";
  let playerId = ""; // "player1" or "player2"

  createBtn.onclick = () => {
    roomId = Math.random().toString(36).substring(2, 8);
    playerId = "player1";
    startGame();
  };

  joinBtn.onclick = () => {
    const val = joinCodeInput.value.trim().toLowerCase();
    if (val.length !== 6) {
      alert("Please enter a valid 6-character room code.");
      return;
    }
    roomId = val;
    playerId = "player2";
    startGame();
  };

  function startGame() {
    setupDiv.style.display = "none";
    gameDiv.style.display = "block";
    roomDisplay.textContent = `Room: ${roomId}`;

    const playerRef = ref(db, `games/${roomId}/${playerId}`);
    set(playerRef, { choice: null });

    const gameRef = ref(db, `games/${roomId}`);

    onValue(gameRef, (snapshot) => {
      const data = snapshot.val();
      if (!data || !data.player1 || !data.player2) {
        status.textContent = "Waiting for another player...";
        resultDiv.textContent = "";
        return;
      }

      const p1Choice = data.player1.choice;
      const p2Choice = data.player2.choice;

      if (p1Choice && p2Choice) {
        const winnerText = determineWinner(p1Choice, p2Choice);
        resultDiv.innerHTML = `
          <p>Player 1 chose: ${p1Choice}</p>
          <p>Player 2 chose: ${p2Choice}</p>
          <h2>${winnerText}</h2>
        `;
        status.textContent = "Game over! Starting new round in 5 seconds...";
        setTimeout(() => {
          // Reset choices to play again
          set(ref(db, `games/${roomId}/player1`), { choice: null });
          set(ref(db, `games/${roomId}/player2`), { choice: null });
          resultDiv.textContent = "";
          status.textContent = "Make your choice!";
        }, 5000);
      } else {
        status.textContent = "Make your choice!";
        resultDiv.textContent = "";
      }
    });

    choices.forEach(button => {
      button.disabled = false;
      button.onclick = () => {
        const choice = button.getAttribute('data-choice');
        set(playerRef, { choice });
        status.textContent = "Choice made, waiting for other player...";
        choices.forEach(btn => btn.disabled = true);
      };
    });
  }

  function determineWinner(p1, p2) {
    if (p1 === p2) return "It's a tie!";
    if (
      (p1 === "rock" && p2 === "scissors") ||
      (p1 === "paper" && p2 === "rock") ||
      (p1 === "scissors" && p2 === "paper")
    ) {
      return "Player 1 Wins!";
    }
    return "Player 2 Wins!";
  }
</script>

</body>
</html>
